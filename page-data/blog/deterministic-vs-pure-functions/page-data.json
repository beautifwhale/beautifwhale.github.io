{"componentChunkName":"component---src-templates-post-js","path":"/blog/deterministic-vs-pure-functions/","result":{"data":{"site":{"siteMetadata":{"title":"davidmorton.dev","siteUrl":"https://davidmorton.dev"}},"markdownRemark":{"id":"6aea48ef-40a7-5095-8ae0-5e3d5dd3db42","excerpt":"All pure functions are deterministic, but not all deterministic functions are pure. Pure functions are easier to reason about and test, you should aim to implement pure functions.","html":"<blockquote>\n<p>All pure functions are deterministic, but not all deterministic functions are pure. Pure functions are easier to reason about and test, you should aim to implement pure functions.</p>\n</blockquote>\n<!-- end -->\n<p>Pure functions are deterministic AND they have no side effects. Deterministic functions may have side effects. Both types of functions return the same output every time they are invoked with the same inputs between invocations. </p>\n<p>You should aim to implement pure functions, they are easier to reason about and test.</p>\n<h2>Deterministic functions</h2>\n<blockquote>\n<p>In mathematics, computer science and physics, a deterministic system is a system in which no randomness is involved in the development of future states of the system. A deterministic model will thus always produce the same output from a given starting condition or initial state.</p>\n<p><a href=\"https://en.wikipedia.org/wiki/Deterministic_system\" target=\"_blank\" rel=\"noreferrer noopener\">https://en.wikipedia.org/wiki/Deterministic_system</a></p>\n</blockquote>\n<p>Deterministic functions will produce the same results given the same inputs. If invoked multiple times using the same input value, the output value will remain the same.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> variableX <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">deterministicFunction</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    variableX <span class=\"token operator\">+=</span> a <span class=\"token operator\">+</span> b <span class=\"token comment\">// side effect</span>\n    <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">deterministicFunction</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 12</span></code></pre></div>\n<p>This deterministic function will return <code class=\"language-text\">12</code> for inputs <code class=\"language-text\">5</code> and <code class=\"language-text\">7</code> no matter how many times we invoke it. It will also increment <code class=\"language-text\">variableX</code> outside of the functions scope, which is known as a side effect. This is a deterministic function, but its not pure because it generates a side effect by updating <code class=\"language-text\">variableX</code>. </p>\n<p>Some other examples of side effects are:</p>\n<ul>\n<li>Modifying variables outside of the functions scope</li>\n<li><code class=\"language-text\">console.log()</code></li>\n<li>HTTP requests <code class=\"language-text\">fetch()</code></li>\n<li>Querying the DOM <code class=\"language-text\">document.*()</code></li>\n<li>Writing to the file system <code class=\"language-text\">fs.writeFile()</code></li>\n<li>Modifying input variables</li>\n</ul>\n<p>If your function is involved in a side effect it may be deterministic, but its definitely not pure.</p>\n<h2>Pure functions</h2>\n<blockquote>\n<p>In computer programming, a pure function is a function that has the following properties:</p>\n<ul>\n<li>Its return value is the same for the same arguments (no variation with local static variables, non-local variables, mutable reference arguments or input streams from I/O devices).</li>\n<li>Its evaluation has no side effects (no mutation of local static variables, non-local variables, mutable reference arguments or I/O streams).</li>\n</ul>\n<p><a href=\"https://en.wikipedia.org/wiki/Pure_function\" target=\"_blank\" rel=\"noreferrer noopener\">https://en.wikipedia.org/wiki/Pure_function</a></p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">pureFunction</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">pureFunction</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 12</span></code></pre></div>\n<p>This deterministic function will return <code class=\"language-text\">12</code> for inputs <code class=\"language-text\">5</code> and <code class=\"language-text\">7</code> no matter how many times we invoke it, and you’ll notice that it does not generate any side effects when invoked. This is known as a pure function.</p>\n<p>Another way to think about pure functions is that they can be replaced by the value the function produces, without affecting the overall programs behaviour. This is known as <a href=\"https://en.wikipedia.org/wiki/Referential_transparency\" target=\"_blank\" rel=\"noreferrer noopener\">Referential transparency</a> and is an attribute of pure functions.</p>\n<h2>Nondeterministic functions</h2>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> variableX <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">hardToTestFunction</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b <span class=\"token operator\">*</span> variableX <span class=\"token comment\">// relies on state outside of function scope</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token function\">hardToTestFunction</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 89</span>\n<span class=\"token function\">hardToTestFunction</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 173</span></code></pre></div>\n<p>When the result of a function is not strictly determined by the inputs, it is nondeterministic, and therefore not pure. In the example above, the result returned by the function is affected by the value of <code class=\"language-text\">variableX</code> and this will change with each new invocation. The value in <code class=\"language-text\">variableX</code> could also be changed by another part of the system, which may change the returned result.</p>\n<h2>Testing</h2>\n<p>Let’s take a look at testing the functions in the above examples, we’ll start off with <code class=\"language-text\">nondeterministic</code>, then <code class=\"language-text\">deterministic</code>, and finally the <code class=\"language-text\">pure</code> function.</p>\n<h3>Nondeterministic</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> variableX <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">hardToTestFunction</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b <span class=\"token operator\">*</span> variableX <span class=\"token comment\">// relies on state outside of function scope</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// test</span>\nvariableX <span class=\"token operator\">=</span> <span class=\"token number\">0</span> <span class=\"token comment\">// given</span>\n<span class=\"token keyword\">let</span> actual <span class=\"token operator\">=</span> <span class=\"token function\">hardToTestFunction</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// when</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">assert</span><span class=\"token punctuation\">(</span>actual <span class=\"token operator\">===</span> <span class=\"token number\">89</span><span class=\"token punctuation\">,</span> actual<span class=\"token punctuation\">)</span> <span class=\"token comment\">// then</span></code></pre></div>\n<p>Nondeterministic functions are difficult to reason about and test effectively, stay away from these or refactor them if you can. In the above example the results we are asserting could be affected by another part of the system changing the value of <code class=\"language-text\">variableX</code>. We do not know how or when this could happen, so how do we test this effectively?</p>\n<h3>Deterministic</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> variableX <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">deterministicFunction</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    variableX <span class=\"token operator\">+=</span> a <span class=\"token operator\">+</span> b <span class=\"token comment\">// side effect</span>\n    <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// test</span>\n<span class=\"token keyword\">let</span> actual <span class=\"token operator\">=</span> <span class=\"token function\">deterministicFunction</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// when</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">assert</span><span class=\"token punctuation\">(</span>actual <span class=\"token operator\">===</span> <span class=\"token number\">12</span><span class=\"token punctuation\">,</span> actual<span class=\"token punctuation\">)</span> <span class=\"token comment\">// then</span></code></pre></div>\n<p>Deterministic functions are a little easier to test than nondeterministic functions because we know that we will get the same result each time we call this function provided we do not change the inputs. </p>\n<p>But when testing, do we need to also test the change in the overall system behaviour as a result of invoking this function? How do we scope this test? How do we know we have tested all related system changes? </p>\n<p>Function side effects usually require mocking or spying on external dependencies, we should try to avoid this as much as possible.</p>\n<h3>Pure</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> variableX <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">pureFunction</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">a<span class=\"token punctuation\">,</span> b</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> a <span class=\"token operator\">+</span> b\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// test</span>\n<span class=\"token keyword\">let</span> actual <span class=\"token operator\">=</span> <span class=\"token function\">pureFunction</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// when</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">assert</span><span class=\"token punctuation\">(</span>actual <span class=\"token operator\">===</span> <span class=\"token number\">12</span><span class=\"token punctuation\">,</span> actual<span class=\"token punctuation\">)</span> <span class=\"token comment\">// then</span></code></pre></div>\n<p>Pure functions are easy to reason about and test. The results of invoking these functions are deterministic, and we don’t have to worry about the overall systems behaviour being changed. Our tests can focus on the logic implemented in the pure function itself, and there is no need to mock or spy on external dependencies.</p>\n<p>The majority of our code should live inside pure functions.</p>\n<h2>Conclusion</h2>\n<p>I’ve discussed the differences between deterministic, pure, and nondeterministic functions in this post. The examples provided are simplistic to illustrate some important points, and I understand that your production code may not be as easy to categorise.</p>\n<p>Somewhere in your program you may need to interact with the file system, and make some network requests, and query the DOM. This functionality should be kept separate from your core functionality or business logic. We can create shells or wrappers to orchestrate and integrate the different parts of our system, while keeping our core code pure and clean.</p>\n<p>Practicing test driven development teaches you to write code that is easier to reason about and maintain. If you like the idea of pure functions and you are not sure how to apply what you have learned here try introduce some TDD into your practice. You’ll spend less time debugging your code and will get organisation and more pure functions for free!. </p>\n<h2>References</h2>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Deterministic_system\" target=\"_blank\" rel=\"noreferrer noopener\">Wikipedia: Deterministic systems</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Pure_function\" target=\"_blank\" rel=\"noreferrer noopener\">Wikipedia: Pure functions</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Referential_transparency\" target=\"_blank\" rel=\"noreferrer noopener\">Wikipedia: Referential transparency</a></li>\n</ul>","frontmatter":{"title":"Deterministic vs. Pure functions","bannerCredit":"Photo by Michael Oxendine","bannerLink":"https://unsplash.com/photos/t7wwffh6x8E","imageAltText":"dog laying on back","keywords":"nodejs,pure,deterministic,functions","banner":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDAf/EABYBAQEBAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAABrMfO8EE//8QAGhABAQADAQEAAAAAAAAAAAAAAQIAAxIRE//aAAgBAQABBQK7uDr7Y6I95GiCR2pn/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEB/9oACAEDAQE/AYmP/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEB/9oACAECAQE/Aauv/8QAHhAAAgEDBQAAAAAAAAAAAAAAABEBAhASEyFCYZH/2gAIAQEABj8Ceo+hVTKOXpjJtb//xAAaEAADAQADAAAAAAAAAAAAAAAAAREhMUGB/9oACAEBAAE/Iazn0SQtGmMToi2MHLKiqleEnOVT/9oADAMBAAIAAwAAABCPP//EABYRAQEBAAAAAAAAAAAAAAAAAAEQUf/aAAgBAwEBPxAGQ//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/EFMv/8QAHBAAAgMBAAMAAAAAAAAAAAAAAREAIUExUWGR/9oACAEBAAE/ECNpip9+fkGJwIyAenARdzpm0RjsdlARNFjeOGhUgAXyf//Z","aspectRatio":1.5,"src":"/static/7c8175a42289c70fb8b470db63a65ea3/94285/banner.jpg","srcSet":"/static/7c8175a42289c70fb8b470db63a65ea3/49df2/banner.jpg 180w,\n/static/7c8175a42289c70fb8b470db63a65ea3/6580d/banner.jpg 360w,\n/static/7c8175a42289c70fb8b470db63a65ea3/94285/banner.jpg 720w,\n/static/7c8175a42289c70fb8b470db63a65ea3/1920d/banner.jpg 1080w,\n/static/7c8175a42289c70fb8b470db63a65ea3/c4b07/banner.jpg 1440w,\n/static/7c8175a42289c70fb8b470db63a65ea3/39dd0/banner.jpg 6000w","sizes":"(max-width: 720px) 100vw, 720px"}}}},"fields":{"slug":"/deterministic-vs-pure-functions/","readingTime":{"text":"6 min read"}}}},"pageContext":{"slug":"/deterministic-vs-pure-functions/","previous":{"fields":{"slug":"/ac-visitor-center-post-mortem/"},"frontmatter":{"title":"Side project: AC Visitor Center"}},"next":{"fields":{"slug":"/deterministic-array-sort-comparator/"},"frontmatter":{"title":"Deterministic sorting"}}}}}