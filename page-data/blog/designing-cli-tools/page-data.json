{"componentChunkName":"component---src-templates-post-js","path":"/blog/designing-cli-tools/","result":{"data":{"site":{"siteMetadata":{"title":"davidmorton.dev","siteUrl":"https://davidmorton.dev"}},"markdownRemark":{"id":"3f94b44d-1f1e-556e-ab43-80f3d709f28e","excerpt":"A Command-Line Interface (CLI) is a way to interact with a program installed on a computer through a terminal interface. Typically these programs receive input via lines of text and will run processes based on this input.","html":"<blockquote>\n<p>A Command-Line Interface (CLI) is a way to interact with a program installed on a computer through a terminal interface. Typically these programs receive input via lines of text and will run processes based on this input.</p>\n</blockquote>\n<!-- end -->\n<p>With a Graphical User Interface (GUI) a user can interact with buttons, menus, dropdowns, radio buttons, etc. A Command-Line Interface (CLI) is different in that a user will typically type commands as lines of text into a terminal shell which are then interpreted to perform some action. Some examples of terminal shells are <a href=\"https://en.wikipedia.org/wiki/Z_shell\" target=\"_blank\" rel=\"noreferrer noopener\">Z Shell</a> or <a href=\"https://en.wikipedia.org/wiki/Bash_(Unix_shell)\" target=\"_blank\" rel=\"noreferrer noopener\">Bash</a>, and some examples of CLI tools are <a href=\"https://docs.npmjs.com/about-npm\" target=\"_blank\" rel=\"noreferrer noopener\">NPM</a> or <a href=\"https://yarnpkg.com/\" target=\"_blank\" rel=\"noreferrer noopener\">Yarn</a>.</p>\n<h2>Orca</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c35040e50b6417a7c939e560d40d08aa/5a190/orca-output.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.37499999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACbklEQVQozz2T6WoTURiGc0ldkkwzk9lnMnsySydtKlT94Q2IbaNWtAv+EaSrSkW66TUIglJbpSAqCG21gleScF6/cyr+eHjn+87Me96zTOXN4z94vfobu0vnePXwh9DDlUscrl5ij54PVn5hf/mn0N1HZzR+Jt4/WLnq7S1fEOei5l6Vlw++owxvIbAzQdvrIXa7/ygROSU8s0NjuagdLUFgFfDNnMgEnpHCViNs9U9Q4akcPYaiyJAnVDRlBbZlwzRMqE0Vru2KWld1aFTXa3WMjoxgbHT0H2NCx0nX5z+gwmPzFKqiQVNsWIaDTpwiDhJ4ToAk7CDyE4QEH5MlBfXqBKQaUb2iXpWobmBj4QiVncVv8K0cmqrBsVwYmk3mJplblMokExsNSaYPJCiNJmrjNVTHOFWhtfG6gE8gEu4vXcBvZSgnu5iduYGpYhZ5+zqlmkSvO4sinSYjHapsUjq+JYao+YRNUt7jk0zUZDy5/RYVfnK+myFLc0yX11DmM7RcOpwoI1NKrjiw9ACOGcE2Qnr2YRKWEQjzhtQUaf8v+cW9LwhaBTrtFN2iR5BhmKJlx2RYiMk8JyUy6nXgWm1RO2YMQ3XFvnN4wqd33omEjJbHkiRm02WPlUWPRUHG/FbC8s4Us82AGZrHTN0jbQnVmrZQXXVYQ1JYvSYx2ke2NveeiVPOg5swmi5dnxA+T2FE4l5xXKMNSw3F1bI1ToSWmYq+oycwFQ+6TEkbDp7fPxXXZriz+HWwPnc0WJs7Gm7MHw+3754ON/snw82F48HmAlfBYLv/ecDHN+Y/Dp/xd6i/Rb2t/idR0981+AtOQ8hO5jOH3AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Orca output\"\n        title=\"Orca output\"\n        src=\"/static/c35040e50b6417a7c939e560d40d08aa/5a190/orca-output.png\"\n        srcset=\"/static/c35040e50b6417a7c939e560d40d08aa/72799/orca-output.png 320w,\n/static/c35040e50b6417a7c939e560d40d08aa/6af66/orca-output.png 640w,\n/static/c35040e50b6417a7c939e560d40d08aa/5a190/orca-output.png 800w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Orca is CLI tool I built that lets you download your Reddit data, specifically your upvoted content, saved content, submissions, and comments. I could not find a tool that let me do this and I also wanted to learn more about CLI design which is why I built it.</p>\n<h2>Planning</h2>\n<p>I envisioned Orca being used to frequently grab my Reddit data by only downloading new content that I had saved since the last download. This would run on a local or remote server on a schedule. I could then access this data over the network. To do this Orca would need to know what the last piece of downloaded data was so that it could pick up where it left off on subsequent runs.  </p>\n<p>I also wanted Orca to download my content from Reddit in the form of a list of links to <code class=\"language-text\">.txt</code> files. I have a bunch of posts “bookmarked” that I want to read at some point and I use the upvoting and save features of Reddit to do this. After some thought I decided that the <code class=\"language-text\">.csv</code> format for the data would be the most useful. This would allow other tools to parse the output, and would also allow users to easily view the data in a spreadsheet tool. Providing other data format options would be a nice to have but not required for the first release.</p>\n<p>Aside from these functional requirements I wanted Orca to be extremely easy to use. Unfortunately getting Reddit API tokens requires some manual steps so the most straight forward way I thought to make this a little easier for users was to provide some documentation in the help section of the CLI. </p>\n<p>So as a first step I recorded the features I wanted as user stories, and also included some “nice to have” features.</p>\n<p>As a <strong>user</strong>:</p>\n<ul>\n<li>I want to download my upvoted content so that I can review it (required)</li>\n<li>I want to download my saved content so that I can review it (required)</li>\n<li>I want to view my data in Excel so that I can review it (required)</li>\n<li>I want to read some documentation that will help me setup the tool (required)</li>\n<li>I want to download only my latest Reddit data so that I’m not downloading all of my data each time I run the tool (required)</li>\n<li>I want to download my comments content so that I can review it (nice to have)</li>\n<li>I want to download my submissions content so that I can review it (nice to have)</li>\n<li>I want to format my data as JSON, txt, or CSV (nice to have)</li>\n</ul>\n<h2>Design</h2>\n<p>Orca interacts with the Reddit API through an NPM package called <a href=\"https://www.npmjs.com/package/snoowrap\" target=\"_blank\" rel=\"noreferrer noopener\">snoowrap</a>. When initialising this package it looks for user authentication credentials. Orca is a CLI tool and so these credentials must be passed as text input on the command line by the user.</p>\n<p>For the initial release of Orca I wanted users to provide as little information as possible to get the tool to do it’s job. Because Orca uses snoowrap under the hood it means that we can provide a few different ways to initialise the tool very easily. </p>\n<h3>Authentication</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">snoowrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    userAgent<span class=\"token operator\">:</span> <span class=\"token string\">'Orca app'</span><span class=\"token punctuation\">,</span>\n    clientId<span class=\"token operator\">:</span> program<span class=\"token punctuation\">.</span>clientId<span class=\"token punctuation\">,</span>\n    clientSecret<span class=\"token operator\">:</span> program<span class=\"token punctuation\">.</span>clientSecret<span class=\"token punctuation\">,</span>\n    accessToken<span class=\"token operator\">:</span> program<span class=\"token punctuation\">.</span>accessToken<span class=\"token punctuation\">,</span>\n    refreshToken<span class=\"token operator\">:</span> program<span class=\"token punctuation\">.</span>refreshToken\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><em>snoowrap configuration requires user authentication credentials</em></p>\n<p>Getting the authentication credentials required for the <strong>snoowrap</strong> package is not very straight forward. I wanted this CLI tool to have a good user experience so I provided a list of steps to gather the required authentication credentials in the help section of the CLI. This will be output to the console for the user to read. </p>\n<h3>Help documentation</h3>\n<p>These steps are presented to the user in the <strong>help</strong> section. To see the help section a user must run the command <code class=\"language-text\">orca -h</code>. This feature of a CLI tool is typically used for documentation related to the available options a CLI tool has, and how to use them. </p>\n<p>The help section of a CLI tool should supplement a more in depth collection of documentation that provides usage examples to the user. This could be a website used specifically for the Orca documentation but as a first step providing enough information to the user in the help section here should get them started quickly.</p>\n<div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">Setup steps:\n- Open https://www.reddit.com/prefs/apps/\n- Click Create app button\n- Pick a name, e.g. Orca web app\n- Select web app as the application type\n- Set redirect url to https://not-an-aardvark.github.io/reddit-oauth-helper/\n- Click Create app button\n- Copy your client id, e.g.\n\n    Orca\n    web app\n    FlF8aE_FAKE_gpYa_LNw (client id)\n    \n- Copy your client secret, e.g.\n\n    secret z1KNAUb_c0MF7_FAKE_hGyR8lfHCQjnzJtGw\n\n- Open https://not-an-aardvark.github.io/reddit-oauth-helper/\n- Input your client id and client secret at the top of the page\n- Select scopes\n    - history\n    - identity\n    - read\n- Click Generate tokens button and then click Allow\n- Copy your access token from the bottom of the page, e.g.\n\n    Access token: 70162531-eWBggyup_FAKE_Usdf1cz7u-G9pM_dhrVf3g\n\n- Run Orca\n\nnpx @mortond/orca --access-token=70162531-eWBggyup_FAKE_Usdf1cz7u-G9pM_dhrVf3g</code></pre></div>\n<p><em>Steps to gather the required authentication credentials of the snoowrap package</em></p>\n<h3>Usage</h3>\n<p>Once the user has read the help section documentation and familiarised themselves with how to get the required authentication credentials like their client Id, client secret, and access token, they can then choose what way they want to initialise Orca. I provided two ways to do this: </p>\n<ul>\n<li>Use an access token which will expire after one hour once created. (one time execution)</li>\n<li>Use a client Id, client secret, and refresh token which will remain active until revoked by the user. (scheduled execution)</li>\n</ul>\n<p>Users may only want to run Orca once to download their current Reddit data, or they may want to run Orca on a schedule to download their data and any subsequent data that is generated as they use Reddit. Providing options for both was easy to do and will provide value to more users.</p>\n<h3>Options</h3>\n<p>I wanted Orca to have a reasonable default configuration. By default, it will download all data types only once in the CSV format, and It will write this data to a default output directory. Each of these defaults are configurable through a set of options.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">--data &lt;string&gt;</code> </p>\n<ul>\n<li>Data to download, e.g. upvoted,saved,submissions,comments</li>\n<li>Default: <code class=\"language-text\">--data=upvoted, saved, submissions, comments</code></li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">--output-dir &lt;directory&gt;</code> </p>\n<ul>\n<li>Output directory for data files</li>\n<li>Default: <code class=\"language-text\">--output-dir=orca-output</code></li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">--format &lt;string&gt;</code></p>\n<ul>\n<li>Downloaded data format</li>\n<li>Default: <code class=\"language-text\">--format=csv</code></li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">--only-latest</code></p>\n<ul>\n<li>Download only the latest data since last execution</li>\n<li>Default: <code class=\"language-text\">--only-latest=false</code></li>\n</ul>\n</li>\n</ul>\n<p>Some of these options are required for the snoowrap package to communicate with the Reddit API depending on use case:</p>\n<p><strong>Scheduled execution, multiple runs</strong></p>\n<ul>\n<li>\n<p><code class=\"language-text\">--client-id &lt;id&gt;</code> (required)</p>\n<ul>\n<li>Reddit application client Id. See <a href=\"https://www.reddit.com/prefs/apps/\" target=\"_blank\" rel=\"noreferrer noopener\">https://www.reddit.com/prefs/apps/</a></li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">--client-secret &lt;secret&gt;</code> (required)</p>\n<ul>\n<li>Reddit application client secret. See <a href=\"https://www.reddit.com/prefs/apps/\" target=\"_blank\" rel=\"noreferrer noopener\">https://www.reddit.com/prefs/apps/</a></li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">--refresh-token &lt;token&gt;</code> (required)</p>\n<ul>\n<li>Refresh token generated using <a href=\"https://not-an-aardvark.github.io/reddit-oauth-helper/\" target=\"_blank\" rel=\"noreferrer noopener\">https://not-an-aardvark.github.io/reddit-oauth-helper/</a></li>\n</ul>\n</li>\n</ul>\n<p><strong>One time execution, token lasts for 24 hours</strong></p>\n<ul>\n<li>\n<p><code class=\"language-text\">--access-token &lt;token&gt;</code> (required)</p>\n<ul>\n<li>Access token generated using <a href=\"https://not-an-aardvark.github.io/reddit-oauth-helper/\" target=\"_blank\" rel=\"noreferrer noopener\">https://not-an-aardvark.github.io/reddit-oauth-helper/</a></li>\n</ul>\n</li>\n</ul>\n<p>With all of these design decisions made around authentication, data formatting, and output locations Orca can be used simply with the following command: </p>\n<div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">npx @mortond/orca --access-token=70162531_FAKE_VxvHpXFiB0DCpA</code></pre></div>\n<p><em>Orca will download the users Reddit data once using it’s default configuration</em></p>\n<h2>Implementation</h2>\n<p>Based on the user stories documented above for this tool I will describe in this section the more interesting parts of the implementation, you can review all of the code on the GitHub repository <a href=\"https://github.com/daithimorton/orca\" target=\"_blank\" rel=\"noreferrer noopener\">here</a>. </p>\n<h3>Formatting</h3>\n<p>For the first release of Orca the only data format I planned to implement was the CSV format, but upon implementing this feature it was trivial to add the other formats JSON and txt.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">formatCsv</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>data <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>data<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">const</span> array <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> array<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">values</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entry</span> <span class=\"token operator\">=></span> entry<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/\\n|\\r|,/gm</span><span class=\"token punctuation\">,</span> <span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">formatTxt</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>data <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>data<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n    data<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            result <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>key<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>item<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/\\n|\\r/gm</span><span class=\"token punctuation\">,</span> <span class=\"token string\">' '</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\n</span><span class=\"token template-punctuation string\">`</span></span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n        result <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">---</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">+</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\\n</span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> result\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">formatJson</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>data <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>data<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Each of the formatter functions receive the same data structure from the previous step in the promise chain. The output of these formatters is a string that is passed on to the file writer. I like how simple and straight forward this implementation is, it will be easy for me to understand what’s happening here If I ever revisit this code. The promise chain reminds me of the chain of responsibility pattern, and the formatter functions resemble the command pattern. </p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  <span class=\"token operator\">...</span>\n  <span class=\"token keyword\">const</span> promises <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">const</span> dataTypeDownloaderMap <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      saved<span class=\"token operator\">:</span> getSavedContent<span class=\"token punctuation\">,</span>\n      upvoted<span class=\"token operator\">:</span> getUpvotedContent<span class=\"token punctuation\">,</span>\n      submissions<span class=\"token operator\">:</span> getSubmissionsContent<span class=\"token punctuation\">,</span>\n      comments<span class=\"token operator\">:</span> getCommentsContent\n  <span class=\"token punctuation\">}</span>\n  dataToDownload<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">dataType</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> downloader <span class=\"token operator\">=</span> dataTypeDownloaderMap<span class=\"token punctuation\">[</span>dataType<span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">const</span> promise <span class=\"token operator\">=</span> <span class=\"token function\">downloader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> config<span class=\"token punctuation\">,</span> onlyLatest <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>saveLatestEntry<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>formatter<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">const</span> filename <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">reddit_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>dataType<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n              <span class=\"token keyword\">return</span> <span class=\"token function\">writeDataToFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> rootOutputDirectory<span class=\"token punctuation\">,</span> dataType<span class=\"token punctuation\">,</span> filename<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> format <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n              <span class=\"token comment\">// do nothing</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      promises<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>promise<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>promises<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">...</span></code></pre></div>\n<p>I’ve implemented a collection of promises for each data type based on the user’s preference using the <code class=\"language-text\">--data</code> option. The steps involved in fetching the user’s Reddit data are all chained together using <code class=\"language-text\">Promise.then()</code>, I could have used <code class=\"language-text\">async/await</code> here but by using a promise chain we can fetch different data types concurrently. The formatter functions are run in this chain and configured prior to this based on the user’s input to the CLI option <code class=\"language-text\">--format</code> which can be <code class=\"language-text\">csv</code>, <code class=\"language-text\">json</code>, or <code class=\"language-text\">txt</code>.</p>\n<h3>Keeping track of the latest data</h3>\n<p>Orca will download all of the user’s Reddit data when it runs by default. A primary use case for this tool is to only download the latest data since the last download so we can run this on a schedule. This means we need to keep track of the last entry in the data each time we run Orca. I’ve done this using a configuration file <code class=\"language-text\">orca.config.js</code> that is written to the current working directory when Orca runs. This configuration file stores the latest entry id for each data type the user has chosen.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n   <span class=\"token property\">\"data\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"saved\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n         <span class=\"token property\">\"latest\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"hwzti5\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"submissions\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n         <span class=\"token property\">\"latest\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"k8s12m\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"comments\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n         <span class=\"token property\">\"latest\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"gcacr12\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"upvoted\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n         <span class=\"token property\">\"latest\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"k8s12m\"</span>\n      <span class=\"token punctuation\">}</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The entry ids in this configuration file are only used if the user specifies the <code class=\"language-text\">--only-latest</code> option when running Orca. We use this id with a data type prefix specified in the Reddit API documentation to fetch all data since this data entry. This allows us to only download the latest data on each run.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token operator\">...</span>\n  <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token function\">getOptions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> dataType<span class=\"token punctuation\">,</span> dataIdPrefix<span class=\"token operator\">:</span> <span class=\"token string\">'t1_'</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">,</span> onlyLatest <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">const</span> spinner <span class=\"token operator\">=</span> <span class=\"token function\">getSpinner</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Fetching </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>chalk<span class=\"token punctuation\">.</span><span class=\"token function\">magentaBright</span><span class=\"token punctuation\">(</span>dataType<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> content</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    spinner<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> r<span class=\"token punctuation\">.</span><span class=\"token function\">getMe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getComments</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token parameter\">listing</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>onlyLatest<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token keyword\">await</span> listing<span class=\"token punctuation\">.</span><span class=\"token function\">fetchAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> listing\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span> <span class=\"token operator\">=></span> error<span class=\"token punctuation\">.</span>statusCode<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<p>The <code class=\"language-text\">t1_</code> prefix specifies <code class=\"language-text\">Comment</code> data when using the Reddit API, and you can see here that we call <code class=\"language-text\">r.getMe()getComments(options)...</code> to fetch the comments data passing in the configured options. We also avoid calling <code class=\"language-text\">listing.fetchAll()</code> here when the <code class=\"language-text\">onlyLatest</code> option is set to make sure we get only the latest data and not all of the data stored for the user. </p>\n<p>While implementing this feature I found it challenging to initially figure out how to keep state for a CLI tool. Typically CLI tools are stateless and so I found that using a configuration file that is queried based on user provided options was the cleanest way to get this to work, and also keeps things simple for the user. NPM does something similar in that when a user installs a new package this information is saved to the <code class=\"language-text\">package.json</code> file.</p>\n<p>I could have implemented another CLI option that consumed a data entry id, e.g. <code class=\"language-text\">gcacr12</code>, and used this as the starting point for the download. But this makes using Orca more complex for the user. They would need to save this entry id off outside of Orca and then pipe it back in when running Orca again. I think using a configuration file for state management provides a better user experience than pushing this onto the user to implement.</p>\n<h2>Conclusion</h2>\n<p>  I really enjoyed working on Orca as it provided an opportunity to learn more about creating a good developer experience for CLI tools and also the tool itself provided immediate utility. There are alot of features that work together to create a good developer experience when making CLI tools. Some of these can be summarised as follows: </p>\n<ul>\n<li>Reasonable defaults</li>\n</ul>\n<p>  CLI tools should “just work” and this requires configuring reasonable defaults for the available options. Provide some out of the box configurations that will suit the majority of users and allow users to customise the most important options.</p>\n<ul>\n<li>Customisability </li>\n</ul>\n<p>  You are wrong to think that you know what your user’s want without talking to them. Try to provide some customisability for things like inputs, outputs, and core logic, but not too much. Less is more here so talk to your users!.</p>\n<ul>\n<li>Help text</li>\n</ul>\n<p>  When I’m trying to learn something new I like having lots of different examples to build a mental model from. Providing some documentation to the user is essential for any tool your trying to build, and the more use case examples you can provide the better. Having a dedicated documentation site will help users to fully understand how they might use your tools which is highly recommended, but having at least some easily accessible help through the <code class=\"language-text\">-h</code> option will get users up and running quickly.</p>\n<ul>\n<li>“cron-able”</li>\n</ul>\n<p>  CLI tools are typically stateless and a good test is to make them “cron-able”, which is to say that you can automate their execution without having to worry about side effects between runs. When state is a requirement for a good developer experience then prefer external state over internal state, e.g. write to a configuration file local to the tool as opposed to storing state in memory. </p>\n<ul>\n<li>Affordance </li>\n</ul>\n<p>  <strong>“the quality or property of an object that defines its possible uses or makes clear how it can or should be used”</strong></p>\n<p>  Do not use abstract terms to describe CLI options, reuse terms your users are already familiar with, even if you think your new terms are way more clever or intuitive. Reducing a users cognitive load is always a good idea when designing a good user experience. Borrow design choices from other CLI tools in relation to option naming, available options, or commands.</p>\n<ul>\n<li>User feedback</li>\n</ul>\n<p>  Provide feedback to the user to communicate how to use the tool, whats happening while it’s running, and if something goes wrong. You can do this through animations or updates in the terminal while it’s running, error messages with clear instructions about what went wrong and how to mitigate the error, and hints when the user leaves out an option or provides a format thats not supported.</p>\n<p>  Most of these features will become apparent the more you talk to your users about how they use your tools, so make it a priority and never assume you know whats best for your users.</p>\n<h2>Related</h2>\n<ul>\n<li><a href=\"/blog/what-is-dev-ux\">What is DX?</a></li>\n</ul>\n<h2>References</h2>\n<ul>\n<li><a href=\"https://github.com/daithimorton/orca\" target=\"_blank\" rel=\"noreferrer noopener\">Orca</a></li>\n<li><a href=\"https://github.com/not-an-aardvark/snoowrap\" target=\"_blank\" rel=\"noreferrer noopener\">snoowrap</a></li>\n<li><a href=\"https://github.com/tj/commander.js/\" target=\"_blank\" rel=\"noreferrer noopener\">Commander.js</a></li>\n<li><a href=\"https://github.com/sindresorhus/ora\" target=\"_blank\" rel=\"noreferrer noopener\">ora</a></li>\n<li><a href=\"https://www.reddit.com/dev/api/\" target=\"_blank\" rel=\"noreferrer noopener\">Reddit API documentation</a></li>\n</ul>","frontmatter":{"title":"Side project: Orca","bannerCredit":"Photo by Matt Artz","bannerLink":"https://unsplash.com/photos/4mAcustUNPs","imageAltText":"two wrenches","keywords":"design,developer experience,cli","banner":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHhQsZg/8QAGRAAAgMBAAAAAAAAAAAAAAAAAAEQERIh/9oACAEBAAEFAqRyE6NuP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABUQAQEAAAAAAAAAAAAAAAAAACAx/9oACAEBAAY/Aqv/xAAbEAACAgMBAAAAAAAAAAAAAAAAARGREDFBIf/aAAgBAQABPyFQe8EcN0MbpFCRqKx//9oADAMBAAIAAwAAABCDz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAQEBAAMBAQAAAAAAAAAAAAERACExYVGB/9oACAEBAAE/EJy5aQOues1RGReLPcBB+g5u9vnLVfu//9k=","aspectRatio":1.313868613138686,"src":"/static/db66d85e7aa260701e6b2d6f5ec4cbe4/94285/banner.jpg","srcSet":"/static/db66d85e7aa260701e6b2d6f5ec4cbe4/49df2/banner.jpg 180w,\n/static/db66d85e7aa260701e6b2d6f5ec4cbe4/6580d/banner.jpg 360w,\n/static/db66d85e7aa260701e6b2d6f5ec4cbe4/94285/banner.jpg 720w,\n/static/db66d85e7aa260701e6b2d6f5ec4cbe4/1920d/banner.jpg 1080w,\n/static/db66d85e7aa260701e6b2d6f5ec4cbe4/c4b07/banner.jpg 1440w,\n/static/db66d85e7aa260701e6b2d6f5ec4cbe4/962a2/banner.jpg 2611w","sizes":"(max-width: 720px) 100vw, 720px"}}}},"fields":{"slug":"/designing-cli-tools/","readingTime":{"text":"14 min read"}}}},"pageContext":{"slug":"/designing-cli-tools/","previous":null,"next":{"fields":{"slug":"/bowhead-react-plugin-system/"},"frontmatter":{"title":"Side project: Bowhead"}}}}}