{"componentChunkName":"component---src-templates-post-js","path":"/blog/flux-unidirectional-data-flow/","result":{"data":{"site":{"siteMetadata":{"title":"davidmorton.dev","siteUrl":"https://davidmorton.dev"}},"markdownRemark":{"id":"293409d9-a5b9-53a9-847f-f91a06474a4e","excerpt":"Flux is the application architecture that Facebook uses for building client-side web applications. Redux is a popular JavaScript implementation of the Flux pattern. This pattern can be explained through the analogy of an insurance company.","html":"<blockquote>\n<p>Flux is the application architecture that Facebook uses for building client-side web applications. Redux is a popular JavaScript implementation of the Flux pattern. This pattern can be explained through the analogy of an insurance company.</p>\n</blockquote>\n<!-- end -->\n<p>I’ve recently been working through a popular <a href=\"https://www.udemy.com/course/react-redux/\" target=\"_blank\" rel=\"noreferrer noopener\">React course on Udemy</a> and in this course the Flux pattern is explained using an insurance company analogy with Redux. I’m going to share this example and expand on it a little, hopefully it’s useful to you.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1127px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8a642b138c1460516be7b6229dba5b45/dcccd/flux-overview.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.0625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABx0lEQVQoz2VSa4+bMBC8//9zKrWV7kPVKtf20kcuUS53TVLCIQiQgMFgG9u8psbkkrRdaeT12Azj3b0pigJ931t03YjX/MJ357Ou7wzXnXm7ti3aE26yLAMhBIPwAMaKc36Nsrzel+d8+LauaytuBZMkgeu62EcHpN4cwewN8t13OKGDL88TLL0lSLRFuL1FGkyx9wLMJo94/rmGH6aYrkIsfqeom+EVRpBzjgGVVNA8wcFdoMoCFKKAn3o40AN0RSHoDortwUuO2E9B4gyMS0SkMhBGsBkFB9tCCGtfKo0hevwd/Yn4l78w/aWGURTBcRxsNhv4QYCcFqAG8THGxl3D27/YfZZT5Ba5uZPblVIKkprn1vpSQ6WUPRyirSVaVUCLEk+7Fd7fv8PdYgJuGtU1HI3m0FpDcgUpFJqmNT8myAt+EQzDEC+mKWF8ROY9gDy+xeHXJxxJAtkKJDkxNVshdW9RxFP4ro9vH+ZY3j+ZRmb4+GOHu7mHuu3HGlZVZWsoh6ZIDsUzSEaxDTb4uv6MB2cGVlJzZpzLEsOLmHEkmIDSNZhxyk5urcP/hrcfmyB1hZyZTlblmR+H2wwz+qvBHvE63H8AJlL66UmpL8MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Flux as an insurance company\"\n        title=\"Flux as an insurance company\"\n        src=\"/static/8a642b138c1460516be7b6229dba5b45/dcccd/flux-overview.png\"\n        srcset=\"/static/8a642b138c1460516be7b6229dba5b45/72799/flux-overview.png 320w,\n/static/8a642b138c1460516be7b6229dba5b45/6af66/flux-overview.png 640w,\n/static/8a642b138c1460516be7b6229dba5b45/dcccd/flux-overview.png 1127w\"\n        sizes=\"(max-width: 1127px) 100vw, 1127px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n<em>The Flux pattern compared to an example workflow in an insurance company</em></p>\n<p>In the above diagram you can see each element of the Flux pattern mapped to a corresponding event in an insurance company.</p>\n<ul>\n<li>View -> People</li>\n<li>Action creator -> Website or phone</li>\n<li>Action -> Create/delete policy or make a claim</li>\n<li>Dispatch -> Send to department</li>\n<li>Reducer -> Department</li>\n<li>State -> Company data and bank balance</li>\n</ul>\n<p>People will interact with the insurance company using a website or phone to create policies, cancel policies, or make claims. This is analogous to UI components using action creators to create actions.</p>\n<p>New policies and claims must be routed to the right departments and processed, similar to how actions are dispatched to reducers. </p>\n<p>And when a department has processed a new policy or claim, the company’s data is modified, this could be the bank balance and/or customers on file. When reducers process actions they return a new updated version of state which becomes the current state.</p>\n<h2>Actions</h2>\n<p>Actions are plain JavaScript objects that are returned from a function. This function is called an action creator.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Flux Insurance company</span>\n<span class=\"token comment\">// </span>\n<span class=\"token comment\">// People (action creator) create a policy, delete a policy, or create a claim (action).</span>\n<span class=\"token comment\">// These are sent (dispatch) to a department (reducer) for processing.</span>\n<span class=\"token comment\">// Which will then update the company's data (state).</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">CREATE_POLICY</span> <span class=\"token operator\">=</span> <span class=\"token string\">'CREATE_POLICY'</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">DELETE_POLICY</span> <span class=\"token operator\">=</span> <span class=\"token string\">'DELETE_POLICY'</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">CREATE_CLAIM</span> <span class=\"token operator\">=</span> <span class=\"token string\">'CREATE_CLAIM'</span>\n\n<span class=\"token comment\">// action creators return an action</span>\n<span class=\"token comment\">// an action is a plain JS object with a type and payload</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createPolicy</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name<span class=\"token punctuation\">,</span> amount</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    type<span class=\"token operator\">:</span> <span class=\"token constant\">CREATE_POLICY</span><span class=\"token punctuation\">,</span>\n    payload<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      name<span class=\"token punctuation\">,</span>\n      amount\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">deletePolicy</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    type<span class=\"token operator\">:</span> <span class=\"token constant\">DELETE_POLICY</span><span class=\"token punctuation\">,</span>\n    payload<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      name\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">createClaim</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">name<span class=\"token punctuation\">,</span> amount</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    type<span class=\"token operator\">:</span> <span class=\"token constant\">CREATE_CLAIM</span><span class=\"token punctuation\">,</span>\n    payload<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      name<span class=\"token punctuation\">,</span> \n      amount\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>Action creators create actions that can be consumed by reducers</em></p>\n<p>Action creators are functions that typically return an object with two properties, in the above example <strong>type</strong> and <strong>payload</strong>. These properties can be named anything you want as long your reducers know how to read them. The <strong>type</strong> differentiates one action from another, if two actions have the same type your reducers may get a little confused and start overwriting data in state. And <strong>payload</strong> is the data you want your reducers to process.</p>\n<h2>Reducers</h2>\n<p>Reducers are like event listeners, they will act on certain types of events and ignore others. Reducers modify state.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// reducers process actions and return updated state </span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">claimsHistory</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> action</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token constant\">CREATE_CLAIM</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> state\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">accounting</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> action</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token constant\">CREATE_CLAIM</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> state <span class=\"token operator\">-</span> action<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">.</span>amount\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">case</span> <span class=\"token constant\">CREATE_POLICY</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> state <span class=\"token operator\">+</span> action<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">.</span>amount\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> state\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">policies</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> action</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">.</span>type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token constant\">CREATE_POLICY</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span> \n    <span class=\"token keyword\">case</span> <span class=\"token constant\">DELETE_POLICY</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> state<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span> <span class=\"token operator\">=></span> name <span class=\"token operator\">!=</span> action<span class=\"token punctuation\">.</span>payload<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> state\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>Company departments are similar to reducers, they process only the events they are interested in, and this modifies the company’s data</em></p>\n<p>Reducers consume actions and update state, they also have access to the current state in order to create new versions. Reducers will consume only the actions they are concerned about. If a reducer is not interested in the current action that was dispatched it will return the current state without modification.</p>\n<h2>State</h2>\n<p>State is a plain JavaScript object stored in browser memory. It is updated by reducers. </p>\n<p>State should be treated as immutable, when creating new versions of state you should use the spread operator <code class=\"language-text\">{...}</code> and use it at each level of an object tree to avoid copying references to the original object contents. We always want new versions of state from our reducers, no lingering references that will cause bugs later. Below is an example of creating deep copies of a JavaScript object, use this approach in your reducers to create new versions of state.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> x <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token string\">'test'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// level 0</span>\n  b<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    name<span class=\"token operator\">:</span> <span class=\"token string\">'x'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// level 1</span>\n    c<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      value<span class=\"token operator\">:</span> <span class=\"token string\">'DFV'</span> <span class=\"token comment\">// level 2</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> y <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>x<span class=\"token punctuation\">,</span> <span class=\"token comment\">// copy level 0 properties and values</span>\n  b<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> \n    <span class=\"token operator\">...</span>x<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">,</span> <span class=\"token comment\">// copy level 1 properties and values</span>\n    c<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>x<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">.</span>c <span class=\"token comment\">// copy level 2 properties and values</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nx<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">'updated'</span>\nx<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token string\">'GME'</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">{</span>\n   <span class=\"token string\">\"a\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span>\n   <span class=\"token string\">\"b\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"updated\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"c\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n         <span class=\"token string\">\"value\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"GME\"</span>\n      <span class=\"token punctuation\">}</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">y</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">{</span>\n   <span class=\"token string\">\"a\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span>\n   <span class=\"token string\">\"b\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"x\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"c\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n         <span class=\"token string\">\"value\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"DFV\"</span>\n      <span class=\"token punctuation\">}</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>Copying object properties and values at each level of an object tree</em></p>\n<p>We want to make copies of an objects properties at each level of the object tree. If we don’t do this we can end up with references to sections fo the original object tree.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> x <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  a<span class=\"token operator\">:</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// level 0</span>\n  b<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> \n    name<span class=\"token operator\">:</span> <span class=\"token string\">\"x\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// level 1</span>\n    c<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> \n      value<span class=\"token operator\">:</span> <span class=\"token string\">\"dfv\"</span> <span class=\"token comment\">// level 2</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> y <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>x<span class=\"token punctuation\">,</span> <span class=\"token comment\">// copy level 0 properties and values</span>\n  b<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>x<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">,</span> <span class=\"token comment\">// copy level 1 properties and values   </span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nx<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"updated\"</span><span class=\"token punctuation\">;</span>\nx<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"GME\"</span><span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">{</span>\n   <span class=\"token string\">\"a\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span>\n   <span class=\"token string\">\"b\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"updated\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"c\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n         <span class=\"token string\">\"value\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"GME\"</span>\n      <span class=\"token punctuation\">}</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">y</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">{</span>\n   <span class=\"token string\">\"a\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">,</span>\n   <span class=\"token string\">\"b\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n      <span class=\"token string\">\"name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"x\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"c\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span> <span class=\"token comment\">// this is a reference to x.b.c because we didn't copy level 2</span>\n         <span class=\"token string\">\"value\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"GME\"</span>\n      <span class=\"token punctuation\">}</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>Only level 0 and level 1 are copied</em></p>\n<p>You can see in the above example, if we only copy level 0 and level 1 we are left with a reference to level 2 of the original object <code class=\"language-text\">x</code>. And so when we update <code class=\"language-text\">x.b.c.value</code> both of the objects <code class=\"language-text\">x</code> and <code class=\"language-text\">y</code> are updated. Trying to track down these types of bugs can be painful so be vigilant.</p>\n<h2>Redux</h2>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// init Redux by combining reducers and creating the store</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>createStore<span class=\"token punctuation\">,</span> combineReducers<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> Redux<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> departments <span class=\"token operator\">=</span> <span class=\"token function\">combineReducers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  claimsHistory<span class=\"token punctuation\">,</span>\n  accounting<span class=\"token punctuation\">,</span>\n  policies\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> store <span class=\"token operator\">=</span> <span class=\"token function\">createStore</span><span class=\"token punctuation\">(</span>departments<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// dispatch sends actions to reducers</span>\nstore<span class=\"token punctuation\">.</span><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">createPolicy</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Alex'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nstore<span class=\"token punctuation\">.</span><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">createPolicy</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Greg'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">90</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nstore<span class=\"token punctuation\">.</span><span class=\"token function\">dispatch</span><span class=\"token punctuation\">(</span><span class=\"token function\">createPolicy</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Jim'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">70</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// state is modified by actions</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// console output</span>\n<span class=\"token punctuation\">{</span>\n   <span class=\"token string\">\"claimsHistory\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>\n      \n   <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n   <span class=\"token string\">\"accounting\"</span><span class=\"token operator\">:</span><span class=\"token number\">280</span><span class=\"token punctuation\">,</span>\n   <span class=\"token string\">\"policies\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"Alex\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"Greg\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"Jim\"</span>\n   <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>Redux is a popular implementation of the Flux pattern, it provides a store, dispatch, and routes actions to reducers</em></p>\n<p>Redux implements the Flux pattern and provides functionality to enable unidirectional data flow. Reducers are registered and ready to consume actions. Actions are created and dispatched by the Redux store. The store holds the latest version of state, and updates this state based on the individual reducer logic.</p>\n<p>You can see from the example above our state contains “slices” based on the names of our reducers. In this way slices of state are kept isolated from each other meaning one reducer can’t update the state of another. If a single action must update two different slices of state at the same time, then each reducer needs to listen out for that action <strong>type</strong> and process the action accordingly.</p>\n<h2>Conclusion</h2>\n<p>In this post we looked at the Flux architecture pattern using the example of an insurance company and implemented it’s data flow using Redux. I have used the Flux pattern in another side project recently to manage client-side application state for features like authentication, and it can get messy very quickly!.</p>\n<p>In my experience reducers and state can get tricky to manage if left to evolve without design. Reducers can grow quickly during development so it’s important to spend some time designing how your state should look before adding that new feature. </p>\n<p>And make sure your state is immutable, it can be difficult to track down a bug caused by a copied object reference instead of the intended values. </p>\n<p>Also try to keep your state slices small following the Separation of concerns (SoC) principle, this will reduce the complexity of your reducers and save you a lot of time in the end game. </p>\n<h2>Related</h2>\n<ul>\n<li><a href=\"/blog/bowhead-react-plugin-system/\">Bowhead</a></li>\n</ul>\n<h2>References</h2>\n<ul>\n<li><a href=\"https://facebook.github.io/flux/docs/in-depth-overview\" target=\"_blank\" rel=\"noreferrer noopener\">Flux</a></li>\n<li><a href=\"https://redux.js.org/\" target=\"_blank\" rel=\"noreferrer noopener\">Redux</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Separation_of_concerns#:~:text=In%20computer%20science%2C%20separation%20of,section%20addresses%20a%20separate%20concern.&#x26;text=When%20concerns%20are%20well%2Dseparated,%2C%20reuse%2C%20and%20independent%20development.\" target=\"_blank\" rel=\"noreferrer noopener\">Separation of concerns (SoC) principle</a></li>\n<li><a href=\"https://www.udemy.com/course/react-redux/\" target=\"_blank\" rel=\"noreferrer noopener\">Modern React with Redux Udemy course</a></li>\n</ul>","frontmatter":{"title":"Flux Insurance Company","bannerCredit":"Photo by Matt Hardy","bannerLink":"https://unsplash.com/photos/6ArTTluciuA","imageAltText":"ocean waves","keywords":"flux,soc,redux,data flow","banner":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMFBP/EABcBAAMBAAAAAAAAAAAAAAAAAAABAgP/2gAMAwEAAhADEAAAAdLoLKzukQH/AP/EABsQAAEEAwAAAAAAAAAAAAAAAAABAgMTBBIx/9oACAEBAAEFAm5DVLYyxhw2EkP/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPwGq/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQIBAT8BiP/EABoQAAICAwAAAAAAAAAAAAAAAAAxAREQITL/2gAIAQEABj8C3FDHimcwf//EABwQAQEBAAEFAAAAAAAAAAAAAAERADFBYXGBwf/aAAgBAQABPyHmj3MdafOJ6FQXCioO+Cfbf//aAAwDAQACAAMAAAAQf8//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAwEBPxAc/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxBEf//EABwQAQADAAIDAAAAAAAAAAAAAAEAESExUUFhwf/aAAgBAQABPxDFc6U+yktA8iiIDQvvJmZ7dgyeCg5mXVWcp//Z","aspectRatio":1.5,"src":"/static/b51c0844811a96b280d29644f359fb93/94285/banner.jpg","srcSet":"/static/b51c0844811a96b280d29644f359fb93/49df2/banner.jpg 180w,\n/static/b51c0844811a96b280d29644f359fb93/6580d/banner.jpg 360w,\n/static/b51c0844811a96b280d29644f359fb93/94285/banner.jpg 720w,\n/static/b51c0844811a96b280d29644f359fb93/1920d/banner.jpg 1080w,\n/static/b51c0844811a96b280d29644f359fb93/c4b07/banner.jpg 1440w,\n/static/b51c0844811a96b280d29644f359fb93/097fa/banner.jpg 1920w","sizes":"(max-width: 720px) 100vw, 720px"}}}},"fields":{"slug":"/flux-unidirectional-data-flow/","readingTime":{"text":"8 min read"}}}},"pageContext":{"slug":"/flux-unidirectional-data-flow/","previous":{"fields":{"slug":"/javascript-try-catch-finally-error-handling/"},"frontmatter":{"title":"JavaScript try/catch/finally error handling"}},"next":{"fields":{"slug":"/ac-visitor-center-post-mortem/"},"frontmatter":{"title":"Side project: AC Visitor Center"}}}}}